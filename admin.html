<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>NBV Command Center V6.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script src="js/database.js"></script>

    <style>
        :root {
            --primary: #0066cc;
            --primary-dark: #004c99;
            --bg: #f3f4f6;
            --sidebar: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
            --danger: #dc2626;
            --success: #16a34a;
            --github: #24292e;
            --highlight: #e0f2fe;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 280px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.02); }
        .brand { font-size: 1.5rem; font-weight: 800; color: var(--text); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--primary); }
        
        .nav-btn { width: 100%; text-align: left; padding: 12px 15px; border: none; background: none; cursor: pointer; color: #6b7280; font-weight: 500; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
        .nav-btn:hover { background: #f9fafb; color: var(--primary); }
        .nav-btn.active { background: #eff6ff; color: var(--primary); font-weight: 700; }
        .nav-btn i { width: 20px; text-align: center; }

        /* Main Content */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h2 { margin-top: 0; margin-bottom: 20px; font-size: 1.5rem; color: #111827; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        h4 { color: var(--primary); margin-top: 25px; margin-bottom: 10px; font-size: 1.1rem; border-left: 4px solid var(--primary); padding-left: 10px; }
        
        /* Forms */
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 6px; font-size: 0.9rem; color: #374151; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,102,204,0.1); }
        .row { display: flex; gap: 15px; } .col { flex: 1; }

        /* Dynamic Lists */
        .list-item { background: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 6px; margin-bottom: 8px; display: flex; gap: 10px; align-items: center; }
        .btn-remove { background: #fee2e2; color: var(--danger); border: none; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn-remove:hover { background: #fecaca; }
        
        /* Table Editor */
        .table-header { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 5px; padding: 0 5px; font-size: 0.8rem; font-weight: bold; color: #666; margin-bottom: 5px; }
        .table-row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 5px; margin-bottom: 5px; }

        /* Buttons */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #15803d; }
        .btn-github { background: var(--github); color: white; }
        .btn-github:hover { background: #000; }
        .btn-add { background: #ecfdf5; color: var(--success); border: 1px dashed var(--success); }
        .btn-add:hover { background: #d1fae5; }

        /* Logs */
        #log-area { margin-top: 10px; font-size: 0.8rem; color: #666; max-height: 80px; overflow-y: auto; background: #fff; padding: 5px; border: 1px solid #eee; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand"><i class="fas fa-camera-retro"></i> Studio<span>NBV</span></div>
        <nav>
            <button class="nav-btn active" onclick="showTab('tab-cliente')"><i class="fas fa-user"></i> Cliente & Contrato</button>
            <button class="nav-btn" onclick="showTab('tab-fotolivro')"><i class="fas fa-book"></i> Tabela Fotolivros</button>
            <button class="nav-btn" onclick="showTab('tab-produtos')"><i class="fas fa-images"></i> Produtos Avulsos</button>
            <button class="nav-btn" onclick="showTab('tab-financeiro')"><i class="fas fa-coins"></i> Financeiro & Log.</button>
            <button class="nav-btn" onclick="showTab('tab-github')"><i class="fab fa-github"></i> Conex√£o GitHub</button>
        </nav>
        
        <div style="margin-top:auto; padding-top:15px; border-top:1px solid #eee">
            <button class="btn btn-success" onclick="gerarZip()">
                <i class="fas fa-file-zipper"></i> GERAR SITE (.ZIP)
            </button>
            <button class="btn btn-github" onclick="salvarNoGithub()">
                <i class="fas fa-cloud-upload-alt"></i> SALVAR DB
            </button>
            <div id="log-area">Pronto.</div>
        </div>
    </div>

    <div class="main-content">

        <div id="tab-cliente" class="section active">
            <h2>Dados do Cliente</h2>
            <div class="form-group">
                <label>Nome do Evento / Cliente</label>
                <input type="text" id="cliName" placeholder="Ex: Casamento Maria e Jo√£o">
            </div>
            <div class="form-group">
                <label>Links das Fotos (Alta Resolu√ß√£o)</label>
                <textarea id="cliFotos" rows="6" placeholder="https://... (Um link por linha)"></textarea>
            </div>
            
            <h4>Contrato e Fluxo</h4>
            
            <div class="row">
                <div class="col">
                    <label class="list-item" style="cursor:pointer; margin-top:0">
                        <input type="checkbox" id="fluxoEdicao"> Perguntar Edi√ß√£o (Prazo)?
                    </label>
                </div>
                <div class="col">
                    <label class="list-item" style="cursor:pointer; margin-top:0">
                        <input type="checkbox" id="fluxoAprovacao"> Passar pela Aprova√ß√£o?
                    </label>
                </div>
            </div>

            <div class="row" style="margin-top:15px">
                <div class="col">
                    <div class="form-group">
                        <label>Entrada J√° Paga (R$)</label>
                        <input type="number" id="cliEntrada" value="0.00">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Incluir Fotolivro?</label>
                        <select id="cliIncluirAlbum" onchange="toggleContratoAlbum()">
                            <option value="nao">N√£o (Venda Avulsa)</option>
                            <option value="sim">Sim (J√° Contratado)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="detalhes-contrato" style="display:none; background:var(--highlight); padding:15px; border-radius:8px; border:1px solid #bae6fd; margin-bottom:20px">
                <h5 style="margin:0 0 10px; color:var(--primary); font-weight:bold">Configura√ß√£o do Contrato</h5>
                <p style="font-size:0.85rem; color:#555">Defina o valor total fechado e o √°lbum base. O sistema calcular√° upgrades a partir disso.</p>
                
                <div class="row">
                    <div class="col">
                        <label>Valor TOTAL do Contrato (R$)</label>
                        <input type="number" id="ctrValorTotal" placeholder="Ex: 2000.00">
                    </div>
                </div>
                <div class="row" style="margin-top:10px">
                    <div class="col">
                        <label>Tamanho Contratado</label>
                        <select id="ctrSize">
                            <option value="15x20">15x20</option>
                            <option value="20x30">20x30</option>
                            <option value="30x40">30x40</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>Qtd. Fotos Base</label>
                        <input type="number" id="ctrQtdFotos" value="20">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Cr√©ditos / Itens Inclusos</label>
                <div id="creditos-list"></div>
                <button class="btn btn-add" onclick="addCreditoRow()">+ Adicionar Item</button>
            </div>
        </div>

        <div id="tab-fotolivro" class="section">
            <h2>Tabela de Pre√ßos e Regras</h2>
            
            <div class="row">
                <div class="col"><label>Markup (Lucro)</label><input type="number" id="markup" step="0.1"></div>
                <div class="col"><label>Custo Fixo Diag.</label><input type="number" id="custoFixo"></div>
                <div class="col"><label>M√≠nimo Fotos √Ålbum</label><input type="number" id="minFotosLivro"></div>
            </div>
            
            <h4>Matriz de Pre√ßos (Custo Base)</h4>
            <div class="table-header">
                <span>Tam</span><span>P√°gs</span><span>Base</span><span>Caixa</span><span></span>
            </div>
            <div id="fotolivro-table"></div>
            <button class="btn btn-add" onclick="addBookRow()">+ Adicionar Linha</button>
            
            <h4>Regras de Diagrama√ß√£o (Fotos por P√°gina)</h4>
            <div id="regras-container"></div>
        </div>

        <div id="tab-produtos" class="section">
            <h2>Produtos Avulsos / Revela√ß√µes</h2>
            <div id="produtos-list"></div>
            <button class="btn btn-add" onclick="addProdRow()">+ Adicionar Produto</button>
        </div>

        <div id="tab-financeiro" class="section">
            <h2>Financeiro e Log√≠stica</h2>
            
            <div class="row">
                <div class="col"><label>Desc. Pix (%)</label><input type="number" id="pixDesc"></div>
                <div class="col"><label>Parc. S/ Juros</label><input type="number" id="noInterest"></div>
            </div>
            <div class="form-group"><label>Tabela Juros (1x..12x)</label><input type="text" id="ratesTable"></div>
            <div class="form-group"><label>Whatsapp (apenas n√∫meros)</label><input type="text" id="whatsNum"></div>
            
            <h4>Log√≠stica Avan√ßada</h4>
            <div class="form-group">
                <label>Cidades com Frete Gr√°tis (Separar por v√≠rgula)</label>
                <input type="text" id="freeCities" placeholder="Ex: Turvo, Boa Ventura, Pitanga">
            </div>
            <div class="form-group">
                <label>Endere√ßo da Sede (Retirada)</label>
                <input type="text" id="sedeAddress">
            </div>
            <div class="form-group">
                <label>Taxa de Envio Transportadora (R$)</label>
                <input type="number" id="shipPrice">
            </div>
        </div>

        <div id="tab-github" class="section">
            <h2>Conex√£o GitHub</h2>
            <div class="form-group"><label>Token (ghp_...)</label><input type="password" id="ghToken"></div>
            <div class="form-group"><label>Usu√°rio GitHub</label><input type="text" id="ghUser"></div>
            <div class="form-group"><label>Reposit√≥rio</label><input type="text" id="ghRepo"></div>
            <button class="btn btn-primary" onclick="salvarCredenciaisLocal()">Salvar no Navegador</button>
        </div>

    </div>

    <script>
        // --- 1. Inicializa√ß√£o ---
        window.onload = function() {
            carregarCredenciaisLocal();
            if(window.NBV_DB) {
                carregarDB(window.NBV_DB);
                log("Dados carregados com sucesso.");
            } else {
                alert("AVISO: database.js n√£o encontrado. Use o Live Server.");
            }
        };

        // --- 2. Carregar Dados na Tela (DB -> DOM) ---
        function carregarDB(db) {
            // Financeiro e Log√≠stica
            document.getElementById('markup').value = db.financeiro.markup || 2.5;
            document.getElementById('custoFixo').value = db.financeiro.custoFixoDiagramacao || 30;
            document.getElementById('pixDesc').value = db.financeiro.descontoPix;
            document.getElementById('noInterest').value = db.financeiro.parcelasSemJuros;
            document.getElementById('ratesTable').value = db.financeiro.tabelaJuros.join(', ');
            document.getElementById('whatsNum').value = db.financeiro.whatsapp;
            
            document.getElementById('shipPrice').value = db.logistica.taxaEnvio;
            document.getElementById('freeCities').value = db.logistica.cidadesGratis.join(', ');
            document.getElementById('sedeAddress').value = db.logistica.enderecoSede;
            
            // Fluxo
            document.getElementById('fluxoEdicao').checked = db.fluxo.pedirEdicao;
            document.getElementById('fluxoAprovacao').checked = db.fluxo.pedirAprovacao;
            document.getElementById('minFotosLivro').value = db.fluxo.minimoFotosLivro;

            // Tabelas
            const tbLivro = document.getElementById('fotolivro-table');
            tbLivro.innerHTML = '';
            db.tabelaFotolivros.forEach(item => addBookRow(item));

            const regContainer = document.getElementById('regras-container');
            regContainer.innerHTML = '';
            for(let size in db.regrasDiagramacao) {
                regContainer.innerHTML += `
                    <div class="row" style="margin-bottom:5px; align-items:center">
                        <div style="width:80px; font-weight:bold">${size}</div>
                        <input type="number" class="regra-input" data-size="${size}" value="${db.regrasDiagramacao[size]}" style="width:80px">
                        <span>fotos/p√°g</span>
                    </div>`;
            }

            // Produtos (Carrega primeiro para o dropdown de cr√©ditos funcionar)
            const tbProd = document.getElementById('produtos-list');
            tbProd.innerHTML = '';
            db.produtosAvulsos.forEach(p => addProdRow(p));
        }

        // --- 3. Montar Objeto (DOM -> JS) ---
        function montarConfiguracao() {
            // Tabela Fotolivros
            const tabelaLivros = [];
            document.querySelectorAll('.book-row').forEach(row => {
                tabelaLivros.push({
                    size: row.querySelector('.bk-size').value,
                    pages: Number(row.querySelector('.bk-pages').value),
                    price: Number(row.querySelector('.bk-price').value),
                    priceBox: Number(row.querySelector('.bk-box').value)
                });
            });

            // Regras
            const regras = {};
            document.querySelectorAll('.regra-input').forEach(inp => {
                regras[inp.dataset.size] = Number(inp.value);
            });

            // Produtos Avulsos
            const prods = [];
            document.querySelectorAll('.prod-row').forEach(row => {
                prods.push({
                    nome: row.querySelector('.pd-name').value,
                    preco: Number(row.querySelector('.pd-price').value),
                    icone: row.querySelector('.pd-icon').value
                });
            });

            return {
                cliente: {
                    nome: document.getElementById('cliName').value,
                    entrada: Number(document.getElementById('cliEntrada').value),
                    incluirAlbum: document.getElementById('cliIncluirAlbum').value === 'sim',
                    // Contrato detalhado com Valor Manual
                    contrato: {
                        valorTotal: Number(document.getElementById('ctrValorTotal').value),
                        tamanho: document.getElementById('ctrSize').value,
                        qtdFotos: Number(document.getElementById('ctrQtdFotos').value)
                    },
                    creditos: getCreditosData()
                },
                fotos: document.getElementById('cliFotos').value.split('\n').filter(x=>x.trim()),
                financeiro: {
                    markup: Number(document.getElementById('markup').value),
                    custoFixoDiagramacao: Number(document.getElementById('custoFixo').value),
                    descontoPix: Number(document.getElementById('pixDesc').value),
                    parcelasSemJuros: Number(document.getElementById('noInterest').value),
                    tabelaJuros: document.getElementById('ratesTable').value.split(',').map(Number),
                    whatsapp: document.getElementById('whatsNum').value
                },
                logistica: {
                    taxaEnvio: Number(document.getElementById('shipPrice').value),
                    cidadesGratis: document.getElementById('freeCities').value.split(',').map(s => s.trim()),
                    enderecoSede: document.getElementById('sedeAddress').value,
                    locaisRetirada: [] // Legacy override
                },
                fluxo: {
                    pedirEdicao: document.getElementById('fluxoEdicao').checked,
                    pedirAprovacao: document.getElementById('fluxoAprovacao').checked,
                    minimoFotosLivro: Number(document.getElementById('minFotosLivro').value)
                },
                tabelaFotolivros: tabelaLivros,
                regrasDiagramacao: regras,
                produtosAvulsos: prods
            };
        }

        // --- 4. Helpers de Interface ---
        function toggleContratoAlbum() {
            const val = document.getElementById('cliIncluirAlbum').value;
            document.getElementById('detalhes-contrato').style.display = (val === 'sim') ? 'block' : 'none';
        }

        function showTab(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const buttons = Array.from(document.querySelectorAll('.nav-btn'));
            const targetIndex = ['tab-cliente','tab-fotolivro','tab-produtos','tab-financeiro','tab-github'].indexOf(id);
            if(targetIndex >= 0) buttons[targetIndex].classList.add('active');
        }

        function addBookRow(data={}) {
            const html = `
                <div class="table-row book-row">
                    <select class="bk-size">
                        <option value="15x20" ${data.size=='15x20'?'selected':''}>15x20</option>
                        <option value="20x30" ${data.size=='20x30'?'selected':''}>20x30</option>
                        <option value="30x40" ${data.size=='30x40'?'selected':''}>30x40</option>
                    </select>
                    <input type="number" class="bk-pages" placeholder="P√°gs" value="${data.pages||''}">
                    <input type="number" class="bk-price" placeholder="Base R$" value="${data.price||''}">
                    <input type="number" class="bk-box" placeholder="Caixa R$" value="${data.priceBox||''}">
                    <button class="btn-remove" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
                </div>`;
            document.getElementById('fotolivro-table').insertAdjacentHTML('beforeend', html);
        }

        function addProdRow(data={}) {
            const html = `
                <div class="list-item prod-row">
                    <input type="text" class="pd-name" placeholder="Nome" value="${data.nome||''}" style="flex:2">
                    <input type="number" class="pd-price" placeholder="Pre√ßo" value="${data.preco||''}" style="flex:1">
                    <input type="text" class="pd-icon" placeholder="fa-class" value="${data.icone||'fas fa-image'}" style="flex:1">
                    <button class="btn-remove" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
                </div>`;
            document.getElementById('produtos-list').insertAdjacentHTML('beforeend', html);
        }

        // V5.5: Cr√©ditos baseados nos produtos existentes
        function addCreditoRow(data={}) {
            // Pega os produtos que existem AGORA na aba Produtos
            const produtosDisponiveis = [];
            document.querySelectorAll('.prod-row .pd-name').forEach(inp => {
                if(inp.value) produtosDisponiveis.push(inp.value);
            });
            
            // Cria as op√ß√µes do Select
            let optionsHtml = '<option value="">-- Selecione o Item --</option>';
            produtosDisponiveis.forEach(prodName => {
                const selected = (data.item === prodName) ? 'selected' : '';
                optionsHtml += `<option value="${prodName}" ${selected}>${prodName}</option>`;
            });

            // Se o item salvo n√£o estiver na lista (ex: foi deletado), adiciona ele pra n√£o quebrar
            if(data.item && !produtosDisponiveis.includes(data.item)) {
                optionsHtml += `<option value="${data.item}" selected>${data.item} (Arquivado)</option>`;
            }

            const html = `
                <div class="list-item credito-row">
                    <select class="cred-name" style="flex:2">
                        ${optionsHtml}
                    </select>
                    <input type="number" class="cred-qtd" placeholder="Qtd" value="${data.qtd||1}" style="width:60px">
                    <button class="btn-remove" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
                </div>`;
            document.getElementById('creditos-list').insertAdjacentHTML('beforeend', html);
        }

        function getCreditosData() {
            const creds = [];
            document.querySelectorAll('.credito-row').forEach(row => {
                creds.push({
                    item: row.querySelector('.cred-name').value,
                    qtd: Number(row.querySelector('.cred-qtd').value)
                });
            });
            return creds;
        }

        function log(msg) { 
            const d = document.getElementById('log-area');
            d.innerHTML = msg + "<br>" + d.innerHTML; 
        }

        // --- 5. GitHub Integration ---
        function salvarCredenciaisLocal() {
            localStorage.setItem('nbv_ghToken', document.getElementById('ghToken').value);
            localStorage.setItem('nbv_ghUser', document.getElementById('ghUser').value);
            localStorage.setItem('nbv_ghRepo', document.getElementById('ghRepo').value);
            alert("Credenciais salvas no navegador!");
        }

        function carregarCredenciaisLocal() {
            if(localStorage.getItem('nbv_ghToken')) document.getElementById('ghToken').value = localStorage.getItem('nbv_ghToken');
            if(localStorage.getItem('nbv_ghUser')) document.getElementById('ghUser').value = localStorage.getItem('nbv_ghUser');
            if(localStorage.getItem('nbv_ghRepo')) document.getElementById('ghRepo').value = localStorage.getItem('nbv_ghRepo');
        }

        async function salvarNoGithub() {
            const token = document.getElementById('ghToken').value;
            const user = document.getElementById('ghUser').value;
            const repo = document.getElementById('ghRepo').value;

            if(!token || !user || !repo) return alert("Preencha a aba GitHub!");
            if(!confirm("Tem certeza que deseja atualizar o database.js no GitHub? Isso mudar√° os pre√ßos globais.")) return;

            log("‚è≥ Conectando GitHub...");
            
            // Monta o DB Mestre (sem dados espec√≠ficos do cliente)
            const configFull = montarConfiguracao();
            const dbMaster = { ...configFull };
            delete dbMaster.cliente; 
            delete dbMaster.fotos;

            const contentStr = `window.NBV_DB = ${JSON.stringify(dbMaster, null, 4)};`;
            const contentB64 = btoa(unescape(encodeURIComponent(contentStr)));

            try {
                // 1. Get SHA
                const url = `https://api.github.com/repos/${user}/${repo}/contents/js/database.js`;
                const getResp = await fetch(url, { headers: { 'Authorization': `token ${token}` } });
                const sha = getResp.ok ? (await getResp.json()).sha : null;

                // 2. Put
                const putResp = await fetch(url, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: "Admin Update: database.js",
                        content: contentB64,
                        sha: sha
                    })
                });

                if(putResp.ok) {
                    log("‚úÖ Salvo no GitHub com sucesso!");
                    alert("Sucesso! Banco de dados atualizado.");
                } else {
                    throw new Error("Erro no upload: " + putResp.status);
                }
            } catch(e) {
                log("‚ùå Erro: " + e.message);
                alert("Erro: " + e.message);
            }
        }

        // --- 6. Gerador ZIP ---
        async function gerarZip() {
            const config = montarConfiguracao();
            if(!config.cliente.nome) return alert("Preencha o Nome do Cliente!");
            if(config.fotos.length === 0) return alert("Cole os links das fotos!");

            log("‚è≥ Gerando ZIP...");
            
            try {
                const zip = new JSZip();
                
                // Configura√ß√£o do Cliente
                zip.file("config_cliente.js", `window.NBV_CONFIG = ${JSON.stringify(config, null, 4)};`);
                
                // Arquivos do Sistema
                const files = [
                    'index.html', 'style.css',
                    'js/core.js', 'js/mod_aprovacao.js', 'js/mod_producao.js', 
                    'js/mod_entrega.js', 'js/mod_pagamento.js', 'js/database.js'
                ];

                for(let f of files) {
                    const resp = await fetch(f);
                    if(!resp.ok) throw new Error("Arquivo n√£o encontrado: " + f);
                    zip.file(f, await resp.text());
                }

                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, `Site_${config.cliente.nome.replace(/\s+/g, '_')}.zip`);
                log("üöÄ ZIP Gerado!");

            } catch(e) {
                log("‚ùå Erro ZIP: " + e.message);
                alert("Erro ao gerar ZIP (verifique se est√° usando Live Server): " + e.message);
            }
        }
    </script>
</body>
</html>
